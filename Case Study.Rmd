---
title: "Divvy Trip Data Analysis (2019 Q1 vs 2020 Q1)"
author: "Anvesh Hirve"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    number_sections: false
    theme: flatly
  pdf_document:
    toc: true
---

```{r setup, include=FALSE}
# Load required libraries
library(tidyverse)
library(lubridate)
library(ggplot2)
library(dplyr)

# Set global options
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

## Introduction

The purpose of this analysis is to compare and understand Divvy bike usage patterns between Q1 2019 and Q1 2020.
We will explore trends based on rider type, duration, day of the week, and time of day to provide insights for business decisions.

## Load and Prepare Data

ds1 <- read.csv("C:/Users/acer/Documents/R Dataset/Divvy_Trips_2019_Q1.csv")
ds2 <- read.csv("C:/Users/acer/Documents/R Dataset/Divvy_Trips_2020_Q1.csv")


## Data Cleaning and Transformation
#Rename columns for consistency
ds1 <- ds1 %>%
rename(
ride_id = trip_id,
started_at = start_time,
ended_at = end_time,
start_station_name = from_station_name,
end_station_name = to_station_name,
start_station_id = from_station_id,
end_station_id = to_station_id,
member_casual = usertype
)
# Convert ID columns to same data type
ds1$ride_id <- as.character(ds1$ride_id)
ds2$ride_id <- as.character(ds2$ride_id)

# Combine both datasets
combined_data <- bind_rows(ds1, ds2)

## Data Preparation
#Convert time columns and extract components
combined_data$started_at <- ymd_hms(combined_data$started_at)
combined_data$ended_at <- ymd_hms(combined_data$ended_at)

combined_data$ride_length <- as.numeric(difftime(combined_data$ended_at, combined_data$started_at, units = "mins"))
combined_data$date <- as.Date(combined_data$started_at)
combined_data$month <- format(combined_data$date, "%m")
combined_data$day <- format(combined_data$date, "%d")
combined_data$year <- format(combined_data$date, "%Y")
combined_data$day_of_week <- format(combined_data$date, "%A")

# Remove negative ride lengths
combined_data <- combined_data[combined_data$ride_length >= 0, ]

## Descriptive Statistics
# Summary of ride length by rider type
aggregate(ride_length ~ member_casual, data = combined_data, FUN = mean)
aggregate(ride_length ~ member_casual, data = combined_data, FUN = median)
aggregate(ride_length ~ member_casual, data = combined_data, FUN = max)
aggregate(ride_length ~ member_casual, data = combined_data, FUN = min)

## Weekly Analysis
# Average ride length by day of week
avg_ride_day <- combined_data %>%
group_by(member_casual, day_of_week) %>%
summarise(mean_ride_length = mean(ride_length), .groups = "drop")

head(avg_ride_day)
```r
# Visualization — Average Ride Duration
ggplot(avg_ride_day, aes(x = day_of_week, y = mean_ride_length, fill = member_casual)) +
geom_col(position = "dodge") +
labs(title = "Average Ride Duration by Day of Week",
x = "Day of Week", y = "Average Duration (minutes)") +
theme_minimal()
``` 
```{r echo=FALSE,out.width="100%"}
knitr::include_graphics("~/Rplot02.png",error = FALSE)
```

## Ride Frequency Analysis
# Number of rides per day of week
rides_per_day <- combined_data %>%
group_by(member_casual, day_of_week) %>%
summarise(number_of_rides = n(), .groups = "drop")

head(rides_per_day)

```r
# Visualization — Number of Rides by Day of Week
ggplot(rides_per_day, aes(x = day_of_week, y = number_of_rides, fill = member_casual)) +
geom_col(position = "dodge") +
labs(title = "Number of Rides by Day of Week",
x = "Day of Week", y = "Number of Rides") +
theme_minimal()
```
```{r echo=FALSE,out.width="100%"}
knitr::include_graphics("~/Rplot01.png",error = FALSE)
```


## Hourly Analysis
# Create hour column and summarize rides per hour
combined_data$hour <- hour(combined_data$started_at)

rides_per_hour <- combined_data %>%
group_by(member_casual, hour) %>%
summarise(rides = n(), .groups = "drop")

head(rides_per_hour)
```r
# Visualization — Hourly Ride Patterns
ggplot(rides_per_hour, aes(x = hour, y = rides, color = member_casual)) +
geom_line(linewidth = 1) +
labs(title = "Hourly Ride Patterns",
x = "Hour of Day", y = "Number of Rides") +
theme_minimal()
```
```{r echo=FALSE,out.width="100%"}
knitr::include_graphics("~/Rplot.png",error = FALSE)
```
## Export Results
write.csv(rides_per_day, "rides_per_day.csv", row.names = FALSE)
write.csv(avg_ride_day, "avg_ride_per_day.csv", row.names = FALSE)

## Conclusion
From this analysis, we can observe:

Casual riders tend to have longer ride durations than members.

Members use bikes more frequently during peak commute hours (morning and evening).

Casual riders ride more during weekends, suggesting recreational use.

These insights can help Divvy design targeted campaigns to convert casual riders into annual members by emphasizing membership benefits for frequent riding.